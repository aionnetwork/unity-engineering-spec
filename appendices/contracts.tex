% java code formatting 
\definecolor{pblue}{rgb}{0.13,0.13,1}
\definecolor{pgreen}{rgb}{0,0.5,0}
\definecolor{pred}{rgb}{0.9,0,0}
\definecolor{pgrey}{rgb}{0.46,0.45,0.48}

\lstset{
tabsize = 4, %% set tab space width
showstringspaces = false, %% prevent space marking in strings, string is defined as the text that is generally printed directly to the console
commentstyle = \color{pgreen}, %% set comment color
keywordstyle = \color{pblue}, %% set keyword color
stringstyle = \color{pred}, %% set string color
rulecolor = \color{pgrey}, %% set frame color to avoid being affected by text color
basicstyle = \small \ttfamily , %% set listing font and size
breaklines = true, %% enable line breaking
numberstyle = \tiny,
}

\section{System Smart Contracts}
\label{appendix:contract}

Following are the AVM smart contracts (extracted as Java interfaces) for the staking and delegation contracts. Only the functions utilized in the major control flows (as described in appendix \ref{appendix:sequence_diagrams}) are provided. Also note that access modifiers (e.g. public, private, etc.) at the class and method level have also been stripped for brevity.

\begin{lstlisting}[language = Java , escapeinside={(*@}{@*)}]
interface StakerRegistry {
    void registerStaker(Address identityAddress, Address managementAddress,
                        Address signingAddress, Address coinbaseAddress);
    void bond(Address staker);
    long unbond(Address staker, BigInteger amount);
    long unbondTo(Address staker, BigInteger amount, Address receiver);
    void finalizeUnbond(Address owner, int limit);
    void delegate(Address staker);
    long undelegate(Address staker, BigInteger amount);
    long undelegateTo(Address staker, BigInteger amount, Address receiver);
    void finalizeUndelegate(Address owner, int limit);
    long transferDelegation(Address fromStaker, Address toStaker, 
                            BigInteger amount);
    void finalizeTransfer(Address staker, int limit);
    void setSigningAddress(Address newSigningAddress);
    void setCoinbaseAddress(Address newCoinbaseAddress);
}

interface PoolRegistry {
    Address registerPool(Address signingAddress, int commissionRate, 
                         byte[] metaDataUrl, byte[] metaDataContentHash);
    void delegate(Address pool);
    long undelegate(Address pool, BigInteger amount);
    void finalizeUndelegate(Address owner, int limit);
    void redelegateRewards(Address pool, BigInteger amount);
    long transferDelegation(Address fromPool, Address toPool, 
                            BigInteger amount);
    void finalizeTransfer(BigInteger transferId);
    BigInteger withdraw(Address pool);
    void enableAutoRewardsDelegation(Address pool, int feePercentage);
    void disableAutoRewardsDelegation(Address pool);
    void autoDelegateRewards(Address pool, Address delegator);
}

interface PoolCoinbase { 
    void transfer(Address recipient, long amount); 
}

\end{lstlisting}
\clearpage